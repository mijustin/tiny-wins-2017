function logicHopConditionBuilder(){var e=this;this.condition_json,this.condition_count=0,this.condition_logic="and",this.condition_class="form-inline",this.condition_input_class="form-control",this.info_default={},this.operators={},this.operators_greater_less={},this.conditions={},this.setData=function(){e.info_default=logichop_text.info_default,e.operators={"==":logichop_text.equal,">":logichop_text.greater,"<=":logichop_text.less_equal,">=":logichop_text.greater_equal,"<":logichop_text.less,"!=":logichop_text.not_equal},e.operators_greater_less={">":logichop_text.greater,"<":logichop_text.less},e.conditions={first_visit:{label:logichop_text.first,map:'{"#operator": [ {"var": "FirstVisit" }, true ] }',lookup:'"FirstVisit"',type:"default",inputs:[{label:"Operator",name:"operator",type:"select",options:{"==":logichop_text.first_true,"!=":logichop_text.first_false}}],info:logichop_text.first_info},direct_visit:{label:logichop_text.direct,map:'{"#operator": [ {"var": "Source" }, "direct" ] }',lookup:"Source",type:"default",inputs:[{label:"Operator",name:"operator",type:"select",options:{"==":logichop_text.direct_true,"!=":logichop_text.direct_false}}],info:logichop_text.direct_info},lead_score:{label:logichop_text.lead_score,map:'{"#operator": [ {"var": "LeadScore" }, "#value" ] }',lookup:"LeadScore",type:"default",inputs:[{label:"Operator",name:"operator",type:"select",options:e.operators},{label:"Value",name:"value",type:"number",placeholder:logichop_text.value,map:1}],info:logichop_text.lead_score_info},geo:{label:logichop_text.geo,map:'{"#operator": [ {"var": "Location.#var" }, "#value" ] }',lookup:"Location\\.",type:"valueSubStrIndex",inputs:[{label:"Location Type",name:"var",type:"select",options:{CountryCode:"Country Code (US, CA, etc)",RegionCode:"State/Region Code (CA, NY, etc)",City:"City",ZIPCode:"ZIP Code",MetroCode:"Metro Code"},map:0},{label:"Operator",name:"operator",type:"select",options:{"==":logichop_text.is,"!=":logichop_text.is_not,"in":logichop_text.is_in_list}},{label:"Value",name:"value",type:"text",placeholder:logichop_text.value,map:1}],info:logichop_text.geo_info},IP:{label:logichop_text.ip,map:'{"#operator": [ {"var": "IP" }, "#value" ] }',lookup:"IP",type:"default",inputs:[{label:"Operator",name:"operator",type:"select",options:{"==":logichop_text.is,"!=":logichop_text.is_not,"in":logichop_text.is_in_list}},{label:"Value",name:"value",type:"text",placeholder:logichop_text.value,map:1}],info:logichop_text.ip_info},mobile:{label:logichop_text.mobile,map:'{"#operator": [ {"var": "Mobile" }, true ] }',lookup:"Mobile",type:"default",inputs:[{label:"Operator",name:"operator",type:"select",options:{"==":logichop_text.mobile_true,"!=":logichop_text.mobile_false}}],info:logichop_text.mobile_info},tablet:{label:logichop_text.tablet,map:'{"#operator": [ {"var": "Tablet" }, true ] }',lookup:"Tablet",type:"default",inputs:[{label:"Operator",name:"operator",type:"select",options:{"==":logichop_text.tablet_true,"!=":logichop_text.tablet_false}}],info:logichop_text.tablet_info},time_elapsed:{label:logichop_text.elapsed,map:'{"#operator": [{"-":[{"var": "Date.Timestamp"},{"var": "Timestamp.#time"}]}, #elapsed]}',lookup:"Timestamp.",type:"default",inputs:[{label:"Time Since",name:"time",type:"select",options:{LastPage:logichop_text.elapsed_3,ThisVisit:logichop_text.elapsed_4,LastVisit:logichop_text.elapsed_2,FirstVisit:logichop_text.elapsed_1},map:0},{label:"Operator",name:"operator",type:"select",options:e.operators_greater_less},{label:"Time Elapsed",name:"elapsed",type:"select",options:{15:"Fifteen Seconds",30:"Thirty Seconds",60:"One Minute",300:"Five Minutes",600:"Ten Minutes",900:"Fifteen Minutes",1800:"Thirty Minutes",3600:"One Hour",7200:"Two Hours",10800:"Three Hours",14400:"Four Hours",18000:"Five Hours",21600:"Six Hours",43200:"Twelve Hours",86400:"One Day",172800:"Two Days",259200:"Three Days",345600:"Four Days",432000:"Five Days",518400:"Six Days",604800:"One Week",1209600:"Two Weeks",1814400:"Three Weeks",2419200:"One Month",4838400:"Two Months",7257600:"Three Months"},map:1}],info:logichop_text.elapsed_info},goal_state:{label:logichop_text.goal,map:'{"#operator": [ {"key_exists": [#goal, {"var": "Goals" }] }, true] }',lookup:'Goals"',type:"valueKeyExists",inputs:[{label:"Goal Name",name:"goal",type:"select",options:logichop_goals,map:0},{label:"Operator",name:"operator",type:"select",options:{"==":logichop_text.completed,"!=":logichop_text.not_completed}}],info:logichop_text.goal_info},goal_state_s:{label:logichop_text.goal_s,map:'{"#operator": [ {"key_exists": [#goal, {"var": "GoalsSession" }] }, true] }',lookup:'GoalsSession"',type:"valueKeyExists",inputs:[{label:"Goal Name",name:"goal",type:"select",options:logichop_goals,map:0},{label:"Operator",name:"operator",type:"select",options:{"==":logichop_text.completed,"!=":logichop_text.not_completed}}],info:logichop_text.goal_info_s},goal_specific_views:{label:logichop_text.goal_cnt,map:'{"#operator": [ {"var": "Goals.#goal" }, #views ] }',lookup:"Goals\\.",type:"valueSubStrIndex",inputs:[{label:"Goal",name:"goal",type:"select",options:logichop_goals,map:0},{label:"Operator",name:"operator",type:"select",options:e.operators},{label:"Views",name:"views",type:"number",map:1}],info:logichop_text.goal_cnt_info},goal_specific_views_s:{label:logichop_text.goal_cnt_s,map:'{"#operator": [ {"var": "GoalsSession.#goal" }, #views ] }',lookup:"GoalsSession\\.",type:"valueSubStrIndex",inputs:[{label:"Goal",name:"goal",type:"select",options:logichop_goals,map:0},{label:"Operator",name:"operator",type:"select",options:e.operators},{label:"Views",name:"views",type:"number",map:1}],info:logichop_text.goal_cnt_info_s},page_current_views:{label:logichop_text.current,map:'{"#operator": [ {"var": "Views" }, #views ] }',lookup:'Views"',type:"default",inputs:[{label:"Operator",name:"operator",type:"select",options:e.operators},{label:"Views",name:"views",map:1,type:"number"}],info:logichop_text.current_info},page_current_views_s:{label:logichop_text.current_s,map:'{"#operator": [ {"var": "ViewsSession" }, #views ] }',lookup:"ViewsSession",type:"default",inputs:[{label:"Operator",name:"operator",type:"select",options:e.operators},{label:"Views",name:"views",map:1,type:"number"}],info:logichop_text.current_info_s},pages_total_views:{label:logichop_text.total,map:'{"#operator": [ {"add_array":{"var":"Pages"}}, #views ] }',lookup:'add_array":{',type:"default",inputs:[{label:"Operator",name:"operator",type:"select",options:e.operators},{label:"Views",name:"views",map:1,type:"number"}],info:logichop_text.total_info},pages_total_views_s:{label:logichop_text.total_s,map:'{"#operator": [ {"add_array":{"var":"PagesSession"}}, #views ] }',lookup:'add_array":{"var":"PagesSession',type:"default",inputs:[{label:"Operator",name:"operator",type:"select",options:e.operators},{label:"Views",name:"views",map:1,type:"number"}],info:logichop_text.total_info_s},page_specific_views:{label:logichop_text.specific,map:'{"#operator": [ {"var": "Pages.#page" }, #views ] }',lookup:"Pages\\.",type:"valueSubStrIndex",inputs:[{label:"Page",name:"page",type:"select",options:logichop_pages,map:0},{label:"Operator",name:"operator",type:"select",options:e.operators},{label:"Views",name:"views",type:"number",map:1}],info:logichop_text.specific_info},page_specific_views_s:{label:logichop_text.specific_s,map:'{"#operator": [ {"var": "PagesSession.#page" }, #views ] }',lookup:"PagesSession\\.",type:"valueSubStrIndex",inputs:[{label:"Page",name:"page",type:"select",options:logichop_pages,map:0},{label:"Operator",name:"operator",type:"select",options:e.operators},{label:"Views",name:"views",type:"number",map:1}],info:logichop_text.specific_info_s},referrer:{label:logichop_text.referrer,map:'{"#operator": ["#url", {"var": "Referrer" }]}',lookup:"Referrer",type:"default",inputs:[{label:"Operator",name:"operator",type:"select",options:{"==":logichop_text.is,"!=":logichop_text.is_not,"in":logichop_text.contains}},{label:logichop_text.url,name:"url",type:"text",map:0}],info:logichop_text.referrer_info},query:{label:logichop_text.query,map:'{"#operator": [ {"var": "Query.#var" }, "#value" ] }',lookup:"Query\\.",type:"valueSubStrIndex",inputs:[{label:"Variable",name:"var",type:"text",placeholder:logichop_text.variable,map:0},{label:"Operator",name:"operator",type:"select",options:{"==":logichop_text.is,"!=":logichop_text.is_not}},{label:"Value",name:"value",type:"text",placeholder:logichop_text.value,map:1}],info:logichop_text.query_info},query_stored:{label:logichop_text.query_se,map:'{"#operator": [ {"var": "QueryStore.#var" }, "#value" ] }',lookup:"QueryStore",type:"valueSubStrIndex",inputs:[{label:"Variable",name:"var",type:"text",placeholder:logichop_text.variable,map:0},{label:"Operator",name:"operator",type:"select",options:{"==":logichop_text.is,"!=":logichop_text.is_not}},{label:"Value",name:"value",type:"text",placeholder:logichop_text.value,map:1}],info:logichop_text.query_se_info},loggedin:{label:logichop_text.user,map:'{"#operator": [ {"var": "LoggedIn" }, true ] }',lookup:"LoggedIn",type:"default",inputs:[{label:"Operator",name:"operator",type:"select",options:{"==":logichop_text.user_in,"!=":logichop_text.user_out}}],info:logichop_text.user_info},date_weekday:{label:logichop_text.weekday,map:'{"#operator": [{"var": "Date.DayNumber" }, #day]}',lookup:"Date.DayNumber",type:"default",inputs:[{label:"Operator",name:"operator",type:"select",options:e.operators},{label:"Day",name:"day",type:"select",options:{1:logichop_text.weekday_1,2:logichop_text.weekday_2,3:logichop_text.weekday_3,4:logichop_text.weekday_4,5:logichop_text.weekday_5,6:logichop_text.weekday_6,7:logichop_text.weekday_7},map:1}],info:logichop_text.weekday_info},date_day:{label:logichop_text.day,map:'{"#operator": [{"var": "Date.Day" }, #day]}',lookup:"Date.Day",type:"default",inputs:[{label:"Operator",name:"operator",type:"select",options:e.operators},{label:"Day",name:"day",type:"select",options:{1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9,10:10,11:11,12:12,13:13,14:14,15:15,16:16,17:17,18:18,19:19,20:20,21:21,22:22,23:23,24:24,25:25,26:26,27:27,28:28,29:29,30:30,31:31},map:1}],info:logichop_text.day_info},date_month:{label:logichop_text.month,map:'{"#operator": [{"var": "Date.Month" }, #month]}',lookup:"Date.Month",type:"default",inputs:[{label:"Operator",name:"operator",type:"select",options:e.operators},{label:"Month",name:"month",type:"select",options:{1:logichop_text.month_01,2:logichop_text.month_02,3:logichop_text.month_03,4:logichop_text.month_04,5:logichop_text.month_05,6:logichop_text.month_06,7:logichop_text.month_07,8:logichop_text.month_08,9:logichop_text.month_09,10:logichop_text.month_10,11:logichop_text.month_11,12:logichop_text.month_12},map:1}],info:logichop_text.month_info},date_year:{label:logichop_text.year,map:'{"#operator": [{"var": "Date.Year" }, #year]}',lookup:"Date.Year",type:"default",inputs:[{label:"Operator",name:"operator",type:"select",options:e.operators},{label:"Year",name:"year",type:"select",options:{2016:"2016",2017:"2017",2018:"2018",2019:"2019",2020:"2020"},map:1}],info:logichop_text.year_info},date_hour:{label:logichop_text.hour,map:'{"#operator": [ {"var": "Date.Hour24" }, #hour ] }',lookup:"Date.Hour24",type:"default",inputs:[{label:"Operator",name:"operator",type:"select",options:e.operators},{label:"Hour",name:"hour",type:"select",options:{0:"12 am",1:" 1 am",2:" 2 am",3:" 3 am",4:" 4 am",5:" 5 am",6:" 6 am",7:" 7 am",8:" 8 am",9:" 9 am",10:"10 am",11:"11 am",12:"12 pm",13:" 1 pm",14:" 2 pm",15:" 3 pm",16:" 4 pm",17:" 5 pm",18:" 6 pm",19:" 7 pm",20:" 8 pm",21:" 9 pm",22:"10 pm",23:"11 pm"},map:1}],info:logichop_text.hour_info},date_minutes:{label:logichop_text.minutes,map:'{"#operator": [ {"var": "Date.Minutes" }, #minutes ] }',lookup:"Date.Minutes",type:"default",inputs:[{label:"Operator",name:"operator",type:"select",options:e.operators},{label:"Minutes",name:"minutes",type:"select",options:{0:":00",1:":01",2:":02",3:":03",4:":04",5:":05",6:":06",7:":07",8:":08",9:":09",10:":10",11:":11",12:":12",13:":13",14:":14",15:":15",16:":16",17:":17",18:":18",19:":19",20:":20",21:":21",22:":22",23:":23",24:":24",25:":25",26:":26",27:":27",28:":28",29:":29",30:":30",31:":31",32:":32",33:":33",34:":34",35:":35",36:":36",37:":37",38:":38",39:":39",40:":40",41:":41",42:":42",43:":43",44:":44",45:":45",46:":46",47:":47",48:":48",49:":49",50:":50",51:":51",52:":52",53:":53",54:":54",55:":55",56:":56",57:":57",58:":58",59:":59"},map:1}],info:logichop_text.minutes_info},date_ymd:{label:logichop_text.date,map:'{"#operator": [ {"var": "Date.Date" }, "#date"]}',lookup:"Date.Date",type:"default",inputs:[{label:"Operator",name:"operator",type:"select",options:e.operators},{label:"Date",name:"date",type:"date",map:1}],info:logichop_text.date_info},path:{label:logichop_text.path,map:'{"#operator": [{"compare_array_slice": [[#pages], {"var": "Path"}]}, true]}',lookup:"Path",type:"default",inputs:[{label:"Operator",name:"operator",type:"select",options:{"==":logichop_text.is,"!=":logichop_text.is_not}},{label:logichop_text.page_1,name:"page-1",type:"select",options:logichop_pages,map:0},{label:logichop_text.page_2,name:"page-2",type:"select",options:logichop_pages,map:1},{label:logichop_text.page_3,name:"page-3",type:"select",options:logichop_pages,map:2},{label:logichop_text.page_4,name:"page-4",type:"select",options:logichop_pages,map:3},{label:logichop_text.page_5,name:"page-5",type:"select",options:logichop_pages,map:4}],info:logichop_text.path_info}},e.conditions=jQuery.extend({},e.conditions,logichop_integration_conditions)},this.addCondition=function(o,t){e.conditions[o]=t},this.init=function(o){if(e.condition_count++,1==e.condition_count)var t=jQuery('<select class="'+e.condition_input_class+' logic"><option value="if">'+logichop_text["if"]+"</option></select>");else var t=jQuery('<select class="'+e.condition_input_class+' logic"><option value="and">'+logichop_text.and+'</option><option value="or">'+logichop_text.or+"</option></select>");var a=jQuery('<select class="'+e.condition_input_class+' type"><option value="">'+logichop_text.select_type+"</option></select>");jQuery.each(e.conditions,function(e,o){a.append(jQuery("<option></option>").attr("value",e).text(o.label))});var i="";o&&(a.val(o),i="loginchop-condition-set");var p='<a href="#" title="'+logichop_text.details+'" class="btn-info">'+logichop_text.details+'</a><div class="info"></div><a href="#" title="'+logichop_text.add_cond+'" class="btn-add button-secondary">+</a><a href="#" title="'+logichop_text.remove_cond+'" class="btn-remove"><small>'+logichop_text.remove+"</small></a></div>",l=jQuery('<div class="'+e.condition_class+" logichop-condition "+i+'"><span class="params"></span>'+p);return l.prepend(a),l.prepend(t),jQuery(".logichop-conditions").append(l),e.updateLogic(e.condition_logic),l.children(".info").html(e.info_default),l},this.refresh=function(o){e.init(!1)},this.display=function(o,t,a){var i=o.children(".params"),p=e.conditions[t].inputs;i.html(""),jQuery.each(p,function(o,t){if("select"==t.type){var p=jQuery('<select class="'+e.condition_input_class+" "+t.name+'"></select>');"operator"!=t.name&&p.append(jQuery('<option value="">'+logichop_text.select+" "+t.label+"</option>")),jQuery.each(t.options,function(e,o){p.append(jQuery("<option></option>").attr("value",e).text(o))}),a&&p.val(a[t.name]),i.append(p)}else if("datalist"==t.type){var l=jQuery('<input class="datalist '+e.condition_input_class+" "+t.name+'" list="'+t.name+'">'),n=jQuery('<datalist id="'+t.name+'"></datalist>');if("operator"!=t.name&&n.append(jQuery('<option value="">'+logichop_text.select+" "+t.label+"</option>")),jQuery.each(t.options,function(e,o){n.append(jQuery("<option></option>").attr("value",o).attr("data-value",e))}),a){var r=n.find('[data-value="'+a[t.name]+'"]').attr("value");r?l.val(r):l.val(a[t.name])}i.append(l),i.append(n)}else{var s="",c="";"number"==t.type&&(s=1,c='min="0" step="1"'),"url"==t.name&&(s="http://"),a&&a[t.name]&&(s=a[t.name]);var _=t.placeholder?'placeholder="'+t.placeholder+'"':"";i.append(jQuery('<input class="'+e.condition_input_class+" "+t.name+'" type="'+t.type+'" value="'+s+'"'+c+" "+_+">"))}}),e.conditions[t].info&&o.children(".info").html(e.conditions[t].info)},this.formatJson=function(){var o,t,a=[];jQuery(".logichop-condition").each(function(t,i){var p=jQuery(this).find(".type").val();o=jQuery(this).find(".logic").val();var l=jQuery(this).find(".params");if(p){var n=e.conditions[p].map,r=[];if(jQuery.each(e.conditions[p].inputs,function(e,o){var t=l.find("."+o.name).val();if(l.find("."+o.name).hasClass("datalist")){var a=jQuery("#"+o.name).find('option[value="'+t+'"]').attr("data-value");a&&(t=a)}if(o.name.search("page-")<0){var i=new RegExp("#"+o.name,"g");n=n.replace(i,t)}else t&&r.unshift(parseInt(t))}),r){var s=new RegExp("#pages","g");n=n.replace(s,r)}a.push(n)}}),t="if"==o?a.toString():'{"'+o+'": ['+a.toString()+"]}",e.condition_json=t,jQuery(".output").html(e.condition_json)},this.parseData=function(o){var t,a=[],i=Object.keys(o);"and"==i[0]||"or"==i[0]?(a=o[i[0]],t=i[0]):a.push(o),jQuery.each(a,function(o,t){var a=Object.keys(t),i=[],p=JSON.stringify(t);i.operator=a[0],jQuery.each(e.conditions,function(e,o){return p.search(o.lookup)>=0?(i.type=e,!1):void 0}),jQuery.each(e.conditions[i.type].inputs,function(o,a){if("operator"!=a.name)if("path"==i.type){var p=t[i.operator][0].compare_array_slice[0].pop();i[a.name]=p}else if("time_elapsed"==i.type){var l=t[i.operator][a.map];if("object"==typeof l){var n=l["-"][1]["var"];i[a.name]=n.substr(n.indexOf(".")+1)}else i[a.name]=l}else{var l=t[i.operator][a.map];if("object"==typeof l){var r=e.conditions[i.type].type;e[r]&&"function"==typeof e[r]&&(i[a.name]=e[r](l))}else i[a.name]=l}});var l=e.init(i.type);e.display(l,i.type,i)}),t&&e.updateLogic(t),e.formatJson()},this.updateLogic=function(e){jQuery(".logic").each(function(){"if"!=jQuery(this).val()&&jQuery(this).val(e)})},this.saveCondition=function(){jQuery("#excerpt").html(this.condition_json)},this.valueKeyExists=function(e){try{return e.key_exists[0]}catch(o){return""}},this.valueInArray=function(e){try{return e["in"][0]}catch(o){return""}},this.valueSubStrIndex=function(e){try{return e["var"].substr(e["var"].indexOf(".")+1)}catch(o){return""}},this.valueSubStrLastIndex=function(e){try{return e["var"].substr(e["var"].lastIndexOf(".")+1)}catch(o){return""}}}var logicHopCB=new logicHopConditionBuilder,logichop_integration_conditions={};jQuery(function(e){logicHopCB.setData(),logichop_data?logicHopCB.parseData(logichop_data):logicHopCB.init(!1),e(".logichop-conditions").on("click",".btn-add",function(e){logicHopCB.init(!1),logicHopCB.saveCondition(),e.preventDefault()}),e("body").on("click",".btn-save",function(e){logicHopCB.saveCondition(),e.preventDefault()}),e("body").on("click",".logichop-condition-logic",function(o){e(".logichop-condition-excerpt").hasClass("logichop-condition-excerpt-hide")?(e(this).html(logichop_text.hide_logic),e(".logichop-condition-excerpt").removeClass("logichop-condition-excerpt-hide")):(e(this).html(logichop_text.show_logic),e(".logichop-condition-excerpt").addClass("logichop-condition-excerpt-hide")),o.preventDefault()}),e("body").on("click","#logichop_css_condition",function(o){e(".logichop-css").hasClass("logichop-condition-excerpt-hide")?e(".logichop-css").removeClass("logichop-condition-excerpt-hide"):e(".logichop-css").addClass("logichop-condition-excerpt-hide")}),e(".logichop-conditions").on("change",".type",function(){var o=e(this).val();o?(logicHopCB.display(e(this).parent(),e(this).val(),!1),e(this).parent().addClass("loginchop-condition-set")):e(this).parent().removeClass("loginchop-condition-set")}),e(".logichop-conditions").on("click",".btn-remove",function(o){e(this).parent().remove(),logicHopCB.condition_count--,"if"!=e(".logichop-condition").first().find(".logic").val()&&(e(".logichop-condition").first().find(".logic").empty(),e(".logichop-condition").first().find(".logic").append('<option value="if">'+logichop_text["if"]+"</option>")),0==logicHopCB.condition_count&&logicHopCB.init(),logicHopCB.formatJson(),logicHopCB.saveCondition(),o.preventDefault()}),e(".logichop-conditions").on("click",".btn-info",function(o){e(this).parent().find(".info").toggle(),o.preventDefault()}),e(".logichop-conditions").on("change",".logic",function(){logicHopCB.condition_logic=e(this).val(),logicHopCB.updateLogic(logicHopCB.condition_logic),logicHopCB.saveCondition()}),e(".logichop-conditions").on("change keyup","input, select",function(){logicHopCB.formatJson(),logicHopCB.saveCondition()})});